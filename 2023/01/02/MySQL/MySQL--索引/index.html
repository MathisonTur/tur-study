<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MySQL--索引, Tur的学习笔记">
    <meta name="description" content="1. 索引概述1.1 介绍索引（index）是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MySQL--索引 | Tur的学习笔记</title>
    <link rel="icon" type="image/png" href="/tur-study/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/tur-study/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/tur-study/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/tur-study/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/tur-study/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/tur-study/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/tur-study/css/matery.css">
<link rel="stylesheet" type="text/css" href="/tur-study/css/my.css">
<link rel="stylesheet" type="text/css" href="/tur-study/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/tur-study/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/tur-study/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/tur-study/css/reward.css">
    



    <script src="/tur-study/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/tur-study/atom.xml" title="Tur的学习笔记" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/tur-study/" class="waves-effect waves-light">
                    
                    <img src="/tur-study/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Tur的学习笔记</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tur-study/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/tur-study/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Tur的学习笔记</div>
        <div class="logo-desc">
            
            学习笔记
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tur-study/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/tur-study/medias/featureimages/5.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MySQL--索引</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tur-study/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/tur-study/categories/MySQL/" class="post-category">
                                MySQL
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-01-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-05-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    29 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/tur-study/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-索引概述"><a href="#1-索引概述" class="headerlink" title="1. 索引概述"></a>1. 索引概述</h2><h3 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h3><p>索引（index）是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161612378.png" alt="image-20230516161240293"></p>
<h3 id="1-2-演示"><a href="#1-2-演示" class="headerlink" title="1.2 演示"></a>1.2 演示</h3><p>表结构机器数据如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161613176.png" alt="image-20230516161330137"></p>
<p>假如我们要执行的SQL语句为 ： <code>select * from user where age = 45;</code></p>
<h4 id="1-2-1-无索引情况"><a href="#1-2-1-无索引情况" class="headerlink" title="1.2.1 无索引情况"></a>1.2.1 无索引情况</h4><p>在无索引情况下，就需要从第一行开始扫描，一直扫描到最后一行，称之为 <strong>全表扫描</strong>，性能很低。</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161614985.png" alt="image-20230516161456931"></p>
<h4 id="1-2-2-有索引情况"><a href="#1-2-2-有索引情况" class="headerlink" title="1.2.2 有索引情况"></a>1.2.2 有索引情况</h4><p>如果我们针对于这张表建立了索引，假设索引结构就是二叉树（但实际上不会用二叉树，而是B+树，这里只为演示索引的作用），那么也就意味着，会对 age 这个字段建立一个二叉树的索引结构</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161617528.png" alt="image-20230516161752462"></p>
<p>此时我们在进行查询时，只需要扫描三次就可以找到数据了，极大的提高的查询的效率。</p>
<h3 id="1-3-特点"><a href="#1-3-特点" class="headerlink" title="1.3 特点"></a>1.3 特点</h3><table>
<thead>
<tr>
<th>优势</th>
<th>劣势</th>
</tr>
</thead>
<tbody><tr>
<td>提高数据检索的效率，降低数据库的IO成本</td>
<td>索引列也是要占用空间的</td>
</tr>
<tr>
<td>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</td>
<td>索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低</td>
</tr>
</tbody></table>
<h2 id="2-索引结构"><a href="#2-索引结构" class="headerlink" title="2. 索引结构"></a>2. 索引结构</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>MySQL 的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构，主要包含以下几种：</p>
<table>
<thead>
<tr>
<th>索引结构</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>B+Tree</td>
<td>最常见的索引类型，大部分引擎都支持 B+ 树索引</td>
</tr>
<tr>
<td>Hash</td>
<td>底层数据结构是用哈希表实现的, 只有精确匹配索引列的查询才有效, 不支持范围查询</td>
</tr>
<tr>
<td>R-tree（空间索引）</td>
<td>空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td>
</tr>
<tr>
<td>Full-text（全文索引）</td>
<td>是一种通过建立<strong>倒排索引</strong>，快速匹配文档的方式。类似于Lucene,Solr,ES</td>
</tr>
</tbody></table>
<p>不同的存储引擎对于索引结构的支持情况如下：</p>
<table>
<thead>
<tr>
<th>索引</th>
<th>InnoDB</th>
<th>MyISAM</th>
<th>Memory</th>
</tr>
</thead>
<tbody><tr>
<td>B+Tree</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>Hash</td>
<td>不支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>R-tree</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>Full-text</td>
<td>5.6 之后支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<blockquote>
<p>若无特别说明，索引一般指 B+Tree 索引</p>
</blockquote>
<h3 id="2-2-二叉树"><a href="#2-2-二叉树" class="headerlink" title="2.2 二叉树"></a>2.2 二叉树</h3><p>假如说MySQL的索引结构采用二叉树的数据结构，比较理想的结构如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161629458.png"></p>
<p>但如果主键是顺序插入的，就会形成单向链表，：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161629701.png"></p>
<p>所以，如果选择二叉树作为索引结构，会存在以下缺点：</p>
<ul>
<li>顺序插入时，会形成一个链表，查询性能大大降低。</li>
<li>大数据量情况下，层级较深，检索速度慢。</li>
</ul>
<p>此时可能有人会想到，我们可以选择红黑树，红黑树是一颗自平衡二叉树，那这样即使是顺序插入数据，最终形成的数据结构也是一颗平衡的二叉树,结构如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161631594.png" alt="image-20230516163106543"></p>
<p>但是，即使如此，由于红黑树也是一颗二叉树，所以也会存在一个缺点：大数据量情况下，层级较深，检索速度慢。<br>所以，在 MySQL 的索引结构中，并没有选择二叉树或者红黑树，而选择的是<code>B+Tree</code></p>
<p>介绍 B+Tree 前先了解一下 B-Tree</p>
<h3 id="2-3-B-Tree"><a href="#2-3-B-Tree" class="headerlink" title="2.3 B-Tree"></a>2.3 B-Tree</h3><p><code>B-Tree</code>，B树是一种多叉路衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。<br>以一颗最大度数（max-degree）为 5(5阶) 的 b-tree 为例，那这个 B 树每个节点最多存储 4 个 key，5个指针：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161634326.png" alt="image-20230516163418261"></p>
<blockquote>
<p>知识小贴士: 树的度数指的是一个节点的子节点个数。</p>
</blockquote>
<p>数据结构可视化网站演示：<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BTree.html">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161640752.png" alt="image-20230516164035675"></p>
<p>特点：</p>
<ul>
<li>5阶的B树，每一个节点最多存储4个key，对应5个指针。</li>
<li>一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂。</li>
<li>在B树中，非叶子节点和叶子节点都会存放数据。</li>
</ul>
<h3 id="2-4-B-Tree"><a href="#2-4-B-Tree" class="headerlink" title="2.4 B+Tree"></a>2.4 B+Tree</h3><p>B+Tree是B-Tree的变种</p>
<p>以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一下其结构示意图：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161642858.png" alt="image-20230516164256800"></p>
<ul>
<li>绿色框框起来的部分，是索引部分，仅仅起到索引数据的作用，不存储数据。</li>
<li>红色框框起来的部分，是数据存储部分，在其叶子节点中要存储具体的数据。</li>
</ul>
<p>数据结构可视化网站演示：<a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161647034.png" alt="image-20230516164748971"></p>
<p>B+Tree 与 B-Tree相比，主要有以下三点区别：</p>
<ul>
<li>所有的数据都会出现在叶子节点。</li>
<li>叶子节点形成一个单向链表。</li>
<li>非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的。</li>
</ul>
<p>上述是标准的 B+Tree 数据结构，而 MySQL 中对 B+Tree 进行了优化</p>
<p>MySQL 索引数据结构对经典的 B+Tree 进行了优化。在原 B+Tree 的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的 B+Tree，提高区间访问的性能，利于排序。</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161649894.png" alt="image-20230516164957832"></p>
<h3 id="2-5-Hash"><a href="#2-5-Hash" class="headerlink" title="2.5 Hash"></a>2.5 Hash</h3><p>MySQL中除了支持B+Tree索引，还支持一种索引类型—Hash索引。</p>
<h4 id="2-5-1-结构"><a href="#2-5-1-结构" class="headerlink" title="2.5.1 结构"></a>2.5.1 结构</h4><p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在 hash 表中</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161703543.png" alt="image-20230516170330471"></p>
<p>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了<strong>hash冲突</strong>（也称为hash碰撞），可以通过<strong>链表</strong>来解决</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161704869.png" alt="image-20230516170427793"></p>
<h4 id="2-5-2-特点"><a href="#2-5-2-特点" class="headerlink" title="2.5.2 特点"></a>2.5.2 特点</h4><ul>
<li><p>Hash 索引只能用于对等比较（<code>=，in</code>），不支持范围查询（<code>between，&gt;，&lt;，…</code>）</p>
</li>
<li><p>无法利用索引完成排序操作</p>
</li>
<li><p>查询效率高，通常（不存在 hash 冲突时）只需要一次检索就可以完成，效率通常要高于 B+Tree 索引</p>
</li>
</ul>
<h4 id="2-5-3-存储引擎支持"><a href="#2-5-3-存储引擎支持" class="headerlink" title="2.5.3 存储引擎支持"></a>2.5.3 存储引擎支持</h4><p>在 MySQL 中，支持 hash 索引的是 Memory 存储引擎。 而 InnoDB 中具有自适应hash功能，hash 索引是 InnoDB 存储引擎根据 B+Tree 索引在指定条件下自动构建的。</p>
<blockquote>
<p>为什么 InnoDB 选择使用 B+Tree 索引？</p>
<ul>
<li>相对于二叉树，层级更少，搜索效率高；</li>
<li>对于 B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；</li>
<li>相对 Hash 索引，B+tree 支持范围匹配及排序操作</li>
</ul>
</blockquote>
<h2 id="3-索引分类"><a href="#3-索引分类" class="headerlink" title="3. 索引分类"></a>3. 索引分类</h2><h3 id="3-1-索引分类"><a href="#3-1-索引分类" class="headerlink" title="3.1 索引分类"></a>3.1 索引分类</h3><p>MySQL 中将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>主键索引</td>
<td>针对于表中主键创建的索引</td>
<td>默认自动创建，且只能由一个</td>
<td>PRIMARY</td>
</tr>
<tr>
<td>唯一索引</td>
<td>避免同一个表中某数据列中的值重复</td>
<td>可以有多个</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>常规索引</td>
<td>快速定位特定数据</td>
<td>可以有多个</td>
<td></td>
</tr>
<tr>
<td>全文索引</td>
<td>全文索引查找的是文本中的关键词，而不是比较索引中的值</td>
<td>可以有多个</td>
<td>FULLTEXT</td>
</tr>
</tbody></table>
<h3 id="3-2-聚集索引-amp-二级索引"><a href="#3-2-聚集索引-amp-二级索引" class="headerlink" title="3.2 聚集索引 &amp; 二级索引"></a>3.2 聚集索引 &amp; 二级索引</h3><p>在 InnoDB 中，根据索引的存储形式，又可以分为以下两种：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>聚集索引</td>
<td>将数据存储与索引放到一块，索引结构的叶子结构保存行数据</td>
<td>必须有，且只能有一个</td>
</tr>
<tr>
<td>二级索引</td>
<td>将数据与索引分类存储，索引结构的叶子结点关联的是对应的主键</td>
<td>可以存在多个</td>
</tr>
</tbody></table>
<p>聚集索引的选取规则：</p>
<ul>
<li>如果存在主键，主键索引就是聚集索引</li>
<li>如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。</li>
<li>如果表没有主键，或没有合适的唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索<br>引</li>
</ul>
<p>聚集索引和二级索引的具体结构如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161719501.png" alt="image-20230516171905416"></p>
<ul>
<li>聚集索引的叶子节点下挂的是这一行的数据 。</li>
<li>二级索引的叶子节点下挂的是该字段值对应的主键值。</li>
</ul>
<p>结合实际执行 SQL 语句，具体的查找过程如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305161720636.png" alt="image-20230516172046560"></p>
<p>具体过程如下：</p>
<ol>
<li>由于是根据 name 字段进行查询，所以先根据 name=’Arm’ 到 name 字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。</li>
<li>由于查询返回的数据是 <code>* </code>，所以此时，还需要根据主键值 10，到聚集索引中查找 10 对应的记录，最终找到 10 对应的行 row。</li>
<li>最终拿到这一行的数据，直接返回即可。</li>
</ol>
<blockquote>
<p>回表查询： 这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取数据的方式，就称之为回表查询。</p>
</blockquote>
<blockquote>
<p>思考：以下两条SQL语句，那个执行效率高? 为什么?</p>
<ul>
<li>A. select * from user where id = 10 ;</li>
<li>B. select * from user where name = ‘Arm’ ;</li>
</ul>
<p>备注: id为主键，name字段创建的有索引</p>
<p>解释：A 语句的执行性能要高于B 语句。因为A语句直接走聚集索引，直接返回数据。 而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。</p>
</blockquote>
<blockquote>
<p>思考：InnoDB主键索引的B+tree高度为多高呢?</p>
<p>假设：一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB的指针占用6个字节的空间，主键即使为bigint，占用字节数为8。<br>高度为2：n * 8 + (n + 1) * 6 = 16 * 1024 , 算出n约为 1170。1171 * 16 = 18736。也就是说，如果树的高度为2，则可以存储 18000 多条记录。<br>高度为3：1171 * 1171 * 16 = 21939856。也就是说，如果树的高度为3，则可以存储 2200w 左右的记录。</p>
</blockquote>
<h2 id="4-索引语法"><a href="#4-索引语法" class="headerlink" title="4. 索引语法"></a>4. 索引语法</h2><p><strong>创建索引</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (index_col_name,...);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>查看索引</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SHOW INDEX FROM table_name;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>删除索引</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">DROP INDEX index_name ON table_name;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="5-SQL-性能分析"><a href="#5-SQL-性能分析" class="headerlink" title="5. SQL 性能分析"></a>5. SQL 性能分析</h2><h3 id="5-1-SQL-执行频率"><a href="#5-1-SQL-执行频率" class="headerlink" title="5.1 SQL 执行频率"></a>5.1 SQL 执行频率</h3><p>MySQL 客户端连接成功后，通过 <code>show [session|global] status</code> 命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的<code>INSERT、UPDATE、DELETE、SELECT</code>的访问频次：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 查询 CRUD 的操作
-- session 是查看当前会话
-- global 是查询全局数据
-- Com_______ 中下划线7个，匹配 insert、update、delete、select
SHOW GLOABL STATUS LIKE 'Com_______';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162128819.png" alt="image-20230516212840747"></p>
<ul>
<li>Com_delete：删除次数</li>
<li>Com_insert：插入次数</li>
<li>Com_select：查询次数</li>
<li>Com_update：更新次数</li>
</ul>
<blockquote>
<p>通过上述指令，我们可以查看到当前数据库到底是以查询为主，还是以增删改为主，从而为数据库优化提供参考依据。 如果是以增删改为主，我们可以考虑不对其进行索引的优化。 如果是以查询为主，那么就要考虑对数据库的索引进行优化了</p>
</blockquote>
<p>如果数据库时以查询为主，该如何定位针对于那些查询语句进行优化？对于次数可以借助于慢查询日志</p>
<h3 id="5-2-慢查询日志"><a href="#5-2-慢查询日志" class="headerlink" title="5.2 慢查询日志"></a>5.2 慢查询日志</h3><p>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有 SQL语句的日志。</p>
<p>MySQL的慢查询日志默认没有开启，可以查看一下系统变量 <code>slow_query_log</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">show varilables like 'slow_query_log';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162213922.png" alt="image-20230516221319824"></p>
<p>如果要开启慢查询日志，需要在MySQL的配置文件（/etc/my.cnf）中配置如下信息：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># 开启 MySQL 慢查询日志开关
slow_query_log=1
# 设置慢日志的时间为2秒，SQL语句执行时间超过2秒，就会视为慢查询，记录慢查询日志
long_query_time=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>配置完毕之后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息<code> /var/lib/mysql/localhost-slow.log</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162215735.png" alt="image-20230516221554666"></p>
<p><strong>测试：</strong></p>
<p>执行如下 SQL 语句：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select * from tb_user; -- 这条SQL执行效率比较高, 执行耗时 0.00sec
select count(*) from tb_sku; -- 由于tb_sku表中, 预先存入了1000w的记录, count一次,耗时13.35sec<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162217976.png" alt="image-20230516221718900"></p>
<p>检查慢查询日志：在慢查询日志中，只会记录执行时间超多我们预设时间（2s）的SQL，执行较快的SQL是不会记录的</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162218322.png" alt="image-20230516221817224"></p>
<p>这样，通过慢查询日志，就可以定位出执行效率比较低的SQL，从而有针对性的进行优化</p>
<h3 id="5-3-profile-详情"><a href="#5-3-profile-详情" class="headerlink" title="5.3 profile 详情"></a>5.3 profile 详情</h3><p><code>show profiles</code> 可以显示 SQL 语句的耗时时间，帮助我们更好的做 SQL 优化。通过  <code>have_profiling</code> 参数，能够看到当前 MySQL 是否支持 <code>profile </code>操作</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 查询是否支持 profile 操作
select @@have_profiles;
-- 查询 profile 操作的开关状态
select @@profiling;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162226957.png" alt="image-20230516222622905"></p>
<p>可以看到，当前 MySQL 是支持 profile操作的，但是开关是关闭的。可以通过set 语句在 session/global 级别开启 profiling：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SET profiling = 1;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在执行一系列的业务 SQL 的操作后，通过如下指令查看 SQL 语句的执行耗时：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 查看每一条 SQL 的耗时基本情况
show profiles;

-- 查看指定 query_id 的 SQL 语句各个阶段的耗时情况
show profile for query query_id;

-- 查看指定 query_id 的 SQL 语句 CPU 的使用情况
show profile cpu for query query_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162233066.png" alt="image-20230516223350009"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162234739.png" alt="image-20230516223414686"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162234957.png" alt="image-20230516223426899"></p>
<h3 id="5-4-explain"><a href="#5-4-explain" class="headerlink" title="5.4 explain"></a>5.4 explain</h3><p>EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括 SELECT 语句执行过程中表如何连接和连接的顺序</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 直接在 select 语句前加上关键字 explain / desc
EXPLAIN SELECT 字段列表 FROM 表名 WHERE 条件;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305162237122.png" alt="image-20230516223741067"></p>
<p>Explain 执行计划中各个字段的含义:</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>select查询的序列号，表示查询中执行select子句或者是操作表的顺序(id相同，执行顺序从上到下；id不同，值越大，越先执行)。</td>
</tr>
<tr>
<td>select_type</td>
<td>表示 SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等</td>
</tr>
<tr>
<td>type</td>
<td>表示连接类型，性能由好到差的连接类型为NULL、system、const、eq_ref、ref、range、 index、all 。</td>
</tr>
<tr>
<td>possible_key</td>
<td>显示可能应用在这张表上的索引，一个或多个。</td>
</tr>
<tr>
<td>key</td>
<td>实际使用的索引，如果为NULL，则没有使用索引。</td>
</tr>
<tr>
<td>key_len</td>
<td>表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好</td>
</tr>
<tr>
<td>rows</td>
<td>MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不总是准确的</td>
</tr>
<tr>
<td>filtered</td>
<td>表示返回结果的行数占需读取行数的百分比， filtered 的值越大越好</td>
</tr>
</tbody></table>
<h2 id="六、索引使用"><a href="#六、索引使用" class="headerlink" title="六、索引使用"></a>六、索引使用</h2><h3 id="6-1-验证索引效率"><a href="#6-1-验证索引效率" class="headerlink" title="6.1 验证索引效率"></a>6.1 验证索引效率</h3><h4 id="6-1-1-数据准备"><a href="#6-1-1-数据准备" class="headerlink" title="6.1.1 数据准备"></a>6.1.1 数据准备</h4><p>环境：表：tb_sku，数据量：1000w</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305170907707.png" alt="image-20230517090717587"></p>
<p>表结构：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CREATE TABLE `tb_sku` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '商品id',
  `sn` varchar(100) NOT NULL COMMENT '商品条码',
  `name` varchar(200) NOT NULL COMMENT 'SKU名称',
  `price` int(20) NOT NULL COMMENT '价格（分）',
  `num` int(10) NOT NULL COMMENT '库存数量',
  `alert_num` int(11) DEFAULT NULL COMMENT '库存预警数量',
  `image` varchar(200) DEFAULT NULL COMMENT '商品图片',
  `images` varchar(2000) DEFAULT NULL COMMENT '商品图片列表',
  `weight` int(11) DEFAULT NULL COMMENT '重量（克）',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  `category_name` varchar(200) DEFAULT NULL COMMENT '类目名称',
  `brand_name` varchar(100) DEFAULT NULL COMMENT '品牌名称',
  `spec` varchar(200) DEFAULT NULL COMMENT '规格',
  `sale_num` int(11) DEFAULT '0' COMMENT '销量',
  `comment_num` int(11) DEFAULT '0' COMMENT '评论数',
  `status` char(1) DEFAULT '1' COMMENT '商品状态 1-正常，2-下架，3-删除',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品表';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>导入本地数据：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">load data local infile 'C:\\Users\\18517\\Desktop\\mysql-data\\tb_sku1.sql' into table `tb_sku` fields terminated by ',' lines terminated by '\n';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><code>C:\\Users\\18517\\Desktop\\mysql-data\\tb_sku1.sql</code> 为本地数据的地址</p>
</blockquote>
<p>导入本地数据时可能会遇到如下错误：Loading local data is disabled； this must be enabled on both the client and server sides</p>
<p>这是因为<code>local_infile</code>服务器变量指示能否使用<code>load data local infile</code>命令。该变量为OFF时，禁用客户端的load data local infile命令，只要我们将该变量设置为ON时， 报错才会消失。</p>
<p>输入 <code>show global vartables like 'local_infile';</code> 查看local_infile服务器的变量是off还是on</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305170911291.png" alt="image-20230517091129229"></p>
<p>修改 local_infile 可以在当前命令行中修改，命令为 <code>set gloabl localinfile=1;</code>。但这是一次性的，关闭命令行后就会失效。要想永久性的修改，需要修改 mysql 目录下的 mysql.ini 文件：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305170914314.png" alt="image-20230517091423254"></p>
<p>在 mysql.ini 文件中<strong>在有[mysqld]，[mysql]字样的下一行加上local_infile=ON命令</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">[mysqld]
local_infile=ON
[mysql]
local_infile=ON <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改完后重启 MySQL 服务即可</p>
<p>数据全部导入后，tb_sku 表中有 1000w 条数据：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305170918391.png" alt="image-20230517091811334"></p>
<h4 id="6-1-2-索引效率验证"><a href="#6-1-2-索引效率验证" class="headerlink" title="6.1.2 索引效率验证"></a>6.1.2 索引效率验证</h4><p><strong>主键索引</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select * from tb_sku where id = 10000000;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305170922297.png" alt="image-20230517092257239"></p>
<p>可以看到即使有1000w的数据，根据id进行数据查询，性能依然很快，因为主键id是有索引的</p>
<p><strong>二级索引</strong></p>
<p>根据 sn 字段进行查询，执行如下 SQL：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SELECT * FROM tb_sku WHERE sn = '100000003145001';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171248769.png" alt="image-20230517124104070"></p>
<p>可以看到根据sn字段进行查询，查询返回了一条数据，结果耗时18.421s，就是因为 sn 没有索引，而造成查询效率很低。</p>
<p>那么我们可以针对于 sn 字段，建立一个索引，建立了索引之后，我们再次根据 sn 进行查询，再来看一下查询耗时情况。</p>
<p>创建索引：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CREATE INDEX idx_sku_sn on tb_sku(sn);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171248745.png" alt="image-20230517124414850"></p>
<p>再次执行相同的 SQL 语句：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171248758.png" alt="image-20230517124441794"></p>
<p>可以看到， sn 字段建立索引之后，查询耗时仅仅需要 0.002s，相比 18.421s，查询性能大大提升</p>
<h3 id="6-2-最左前缀法则"><a href="#6-2-最左前缀法则" class="headerlink" title="6.2 最左前缀法则"></a>6.2 最左前缀法则</h3><p>如果索引了多列（联合索引），要遵循最左前缀法则。</p>
<p>最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中的列，如果跳跃某一列，索引将会部分失效（后面的字段索引失效）</p>
<p>以 tb_user 表为例，tb_user 表所创建的索引如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171249149.png" alt="image-20230517124945962"></p>
<p>在 tb_user 表中，有一个联合索引，这个联合索引涉及到三个字段，顺序分别为：profession，age，status</p>
<p>对于最左前缀法则指的是，查询时，最左变的列，也就是profession必须存在，否则索引全部失效。而且中间不能跳过某一列，否则该列后面的字段索引将失效。</p>
<p>示例演示如下：</p>
<p><strong>最左前缀法则验证：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程' and age = 31 and status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171251723.png" alt="image-20230517125115595"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程' and age = 31;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171251339.png" alt="image-20230517125154212"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171252730.png" alt="image-20230517125219607"></p>
<p>以上的这三组测试中，我们发现只要联合索引最左边的字段 profession存在，索引就会生效，只不过索引的长度不同。 而且由以上三组测试，我们也可以推测出 profession 字段索引长度为47、age 字段索引长度为2、status字段索引长度为5</p>
<p><strong>最左前缀法则失效：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where age = 31 and status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171253307.png" alt="image-20230517125308208"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171253841.png" alt="image-20230517125334724"></p>
<p>而通过上面的这两组测试，我们也可以看到索引并未生效，原因是因为不满足最左前缀法则，联合索引最左边的列profession不存在</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程' and status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171254417.png" alt="image-20230517125413300"></p>
<p>上述的SQL查询时，存在profession字段，最左边的列是存在的，索引满足最左前缀法则的基本条件。但是查询时，跳过了age这个列，所以后面的列索引是不会使用的，也就是索引部分生效，所以索引的长度就是47</p>
<p><strong>SQL 语句的字段顺序的影响：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where age = 31 and status = '0' and profession = '软件工程'；<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171255063.png" alt="image-20230517125515940"></p>
<p>可以看到，当 SQL 语句的字段顺序与索引的字段不一致时没有影响，依旧是完全满足最左前缀法则的，索引长度54，联合索引是生效的。</p>
<blockquote>
<p>注意 ： 最左前缀法则中指的最左边的列，是指在查询时，联合索引的最左边的字段(即是第一个字段)必须存在，与我们编写SQL时，条件编写的先后顺序无关。</p>
</blockquote>
<h3 id="6-3-范围查询"><a href="#6-3-范围查询" class="headerlink" title="6.3 范围查询"></a>6.3 范围查询</h3><p>联合索引中，出现范围查询<code>(&gt;,&lt;)</code>，范围查询右侧的列索引失效。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程' and age &gt; 30 and status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171300231.png" alt="image-20230517130055148"></p>
<p>当范围查询使用<code>&gt; </code>或 <code>&lt; </code>时，走联合索引了，但是索引的长度为49，就说明范围查询右边的 status 字段是没有走索引的</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession = '软件工程' and age &gt;= 30 and status = '0';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171301473.png" alt="image-20230517130141375"></p>
<p>当范围查询使用<code>&gt;= </code>或 <code>&lt;= </code>时，走联合索引了，但是索引的长度为54，就说明所有的字段都是走索引的。</p>
<p>所以，在业务允许的情况下，尽可能的使用类似于 <code>&gt;= 或 &lt;= </code>这类的范围查询，而避免使用<code> &gt; 或 &lt;</code>。</p>
<h3 id="6-4-索引失效情况"><a href="#6-4-索引失效情况" class="headerlink" title="6.4 索引失效情况"></a>6.4 索引失效情况</h3><h4 id="6-4-1-索引列运算"><a href="#6-4-1-索引列运算" class="headerlink" title="6.4.1 索引列运算"></a>6.4.1 索引列运算</h4><p>不要在索引列上进行运算操作， 索引将失效。</p>
<p>示例如下：</p>
<p>在tb_user表中，除了前面介绍的联合索引之外，还有一个索引，是phone字段的单列索引。</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171303896.png" alt="image-20230517130341751"></p>
<ul>
<li><p>当根据 phone 字段进行等值匹配查询时, 索引生效</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171304897.png" alt="image-20230517130419790"></p>
</li>
<li><p>当根据phone字段进行函数运算操作之后，索引失效。</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171304008.png" alt="image-20230517130447902"></p>
</li>
</ul>
<h4 id="6-4-2-字符串不加引号"><a href="#6-4-2-字符串不加引号" class="headerlink" title="6.4.2 字符串不加引号"></a>6.4.2 字符串不加引号</h4><p>字符串类型字段使用时，不加引号，索引将失效。</p>
<p>示例如下：</p>
<p><strong>联合索引：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 加单引号
explain select * from tb_user where profession = '软件工程' and age = 31 and status= '0';
-- 不加单引号
explain select * from tb_user where profession = '软件工程' and age = 31 and status= 0;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171308669.png" alt="image-20230517130825480"></p>
<p><strong>单列索引：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">-- 加单引号
explain select * from tb_user where phone = '17799990015';
-- 不加单引号
explain select * from tb_user where phone = 17799990015;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171309661.png" alt="image-20230517130916503"></p>
<p>经过上面两组示例，可以发现，如果字符串不加单引号，对于查询结果，没什么影响，但是数<br>据库存在隐式类型转换，索引将失效。</p>
<h4 id="6-4-3-模糊查询"><a href="#6-4-3-模糊查询" class="headerlink" title="6.4.3 模糊查询"></a>6.4.3 模糊查询</h4><p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p>
<p>示例如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession like '软件%';
explain select * from tb_user where profession like '%工程';
explain select * from tb_user where profession like '%工%';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171343520.png" alt="image-20230517134351321"></p>
<p>经过上述的测试，可以发现，在like模糊查询中，在关键字后面加%，索引可以生效。而如果在关键字前面加了%，索引将会失效。</p>
<h4 id="6-4-4-or-连接条件"><a href="#6-4-4-or-连接条件" class="headerlink" title="6.4.4 or 连接条件"></a>6.4.4 or 连接条件</h4><p>用or分割开的条件， 如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where id = 10 or age = 23;
explain select * from tb_user where phone = '17799990017' or age = 23;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171345587.png" alt="image-20230517134514424"></p>
<p>由于age没有索引，所以即使id、phone有索引，索引也会失效。所以需要针对于age也要建立索引</p>
<p>对 age 字段建立索引后，再次执行上述的 SQL 语句，可以看到索引生效</p>
<h4 id="6-4-5-数据分布影响"><a href="#6-4-5-数据分布影响" class="headerlink" title="6.4.5 数据分布影响"></a>6.4.5 数据分布影响</h4><p>如果 MySQL 评估使用索引比全表更慢，则不使用索引。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select * from tb_user where phone &gt;= '17799990005';
select * from tb_user where phone &gt;= '17799990015';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171347107.png" alt="image-20230517134718913"></p>
<p>经过测试可以发现，相同的SQL语句，只是传入的字段值不同，最终的执行计划也完全不一样</p>
<p>这是因为 MySQL 在查询时，会评估使用索引的效率与走全表扫描的效率，如果走全表扫描更快，则放弃索引，走全表扫描。 因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效。</p>
<p>示例：<code> is null</code> 与<code>is not null</code>操作是否走索引。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user where profession is null;
explain select * from tb_user where profession is not null;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171350442.png" alt="image-20230517135013217"></p>
<p>若是将 profession 字段值全部更新为 null：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171350282.png" alt="image-20230517135059205"></p>
<p>再次执行上述的两条SQL，查看SQL语句的执行计划：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171351905.png" alt="image-20230517135120757"></p>
<p>最终可以看到，一模一样的SQL语句，先后执行了两次，结果查询计划是不一样的，这是和数据库的数据分布有关系。查询时MySQL会评估，走索引快，还是全表扫描快，如果全表扫描更快，则放弃索引走全表扫描。 因此，is null 、is not null是否走索引，得具体情况具体分析，并不是固定的。</p>
<h3 id="6-5-SQL-提示"><a href="#6-5-SQL-提示" class="headerlink" title="6.5 SQL 提示"></a>6.5 SQL 提示</h3><p>在 tb_user 表中， profession 字段有联合索引，若此时给改字段添加一个单列索引，查询时索引会使用哪一个？</p>
<p>对于一个既有联合索引又有单列索引的字段，MySQL 会自动选择一个，若是想自己指定使用哪个索引，就需要借助 MySQL 的 SQL 提示来完成</p>
<p>SQL 提示，是优化数据库的一种重要手段，简单来说就是在 SQL 语句中加入一些人为的提示来达到优化操作的目的</p>
<p>相关的操作命令如下：</p>
<ul>
<li><p><code>use index</code>：建议 MySQL 使用哪一个索引来完成此次查询（仅仅是建议，MySQL 内部还会再次进行评估）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user use index(idx_user_pro) where profession = '软件工程';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>ignore index</code>：忽略指定索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user ignore index(idx_user_pro) where profession = '软件工程';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>force index：强制使用索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select * from tb_user force index(idx_user_pro) where profession = '软件工程';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h3 id="6-6-覆盖索引"><a href="#6-6-覆盖索引" class="headerlink" title="6.6 覆盖索引"></a>6.6 覆盖索引</h3><p>尽量使用<font color="red">覆盖索引</font>，减少 <code>select *</code></p>
<p>覆盖索引是指查询使用了索引，并且需要返回的列在该索引中已经全部找到</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">explain select id, profession from tb_user where profession = '软件工程' and age =31 and status = '0' ;

explain select id,profession,age, status from tb_user where profession = '软件工程'and age = 31 and status = '0' ;

explain select id,profession,age, status, name from tb_user where profession = '软件工程' and age = 31 and status = '0' ;

explain select * from tb_user where profession = '软件工程' and age = 31 and status= '0';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171403329.png" alt="image-20230517140340049"></p>
<p>从上述的执行计划可以看到，这四条SQL语句的执行计划前面所有的指标都是一样的，看不出来差异。但是此时，我们主要关注的是后面的Extra，前面两天SQL的结果为 <code>Using where; UsingIndex ;</code> 而后面两条SQL的结果为: <code>Using index condition </code></p>
<table>
<thead>
<tr>
<th>Extra</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Using where; Using Index</td>
<td>查找使用了索引，但是需要的数据都在索引列中都能找到，索引不需要回表查询数据</td>
</tr>
<tr>
<td>Using index condition</td>
<td>查找使用了索引，但是需要回表查询数据</td>
</tr>
</tbody></table>
<p>因为，在tb_user表中有一个联合索引 idx_user_pro_age_sta，该索引关联了三个字段 profession、age、status，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主键id。 所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引<br>直接返回数据了。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据了，这个过程就是回表。 而我们如果一直使用<code>select * </code>查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。</p>
<p>演示示例如下：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171412830.png" alt="image-20230517141243674"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171413111.png" alt="image-20230517141259974"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171413406.png" alt="image-20230517141326305"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171413255.png" alt="image-20230517141351128"></p>
<p>那么在应用中，如何针对 SQL 语句进行优化？—— 使用覆盖索引：</p>
<p>一张表, 有四个字段<code>(id, username, password, status)</code>, 由于数据量大, 需要对以下SQL语句进行优化, 该如何进行才是最优方案：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select id,username,password from tb_user where username = 'itcast';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>答案: 针对于 <code>username, password</code> 建立联合索引, sql 为: </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">create index idx_user_name_pass on tb_user(username,password); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样可以避免上述的SQL语句，在查询的过程中，出现回表查询。</p>
<h3 id="6-7-前缀索引"><a href="#6-7-前缀索引" class="headerlink" title="6.7 前缀索引"></a>6.7 前缀索引</h3><p>当字段类型为字符串（<code>varchar，text，longtext</code>等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO， 影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">create idnex idx_xxxx on table_name(column(n));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>前缀长度：</strong></p>
<p>可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高， 唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select count(distinct email) / count(*) from tb_user ;
select count(distinct substring(email,1,5)) / count(*) from tb_user ;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>前缀索引的查询流程：</strong></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171423566.png" alt="image-20230517142307460"></p>
<h3 id="6-8-单列索引和联合索引"><a href="#6-8-单列索引和联合索引" class="headerlink" title="6.8 单列索引和联合索引"></a>6.8 单列索引和联合索引</h3><ul>
<li>单列索引：即一个索引只包含单个列。</li>
<li>联合索引：即一个索引包含了多个列。</li>
</ul>
<p>在 SQL 语句中有 and 连接两个都有单列索引的字段时，MySQL 只会选择一个索引，即只能走一个字段的索引，此时会回表查询的，这时则需要对这两个字段建立联合索引</p>
<blockquote>
<p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引。</p>
</blockquote>
<p>示例如下：</p>
<p>字段 phone、name 都有单列索引：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171430401.png" alt="image-20230517143004249"></p>
<p>字段 phone、name 建立联合索引后：</p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171431539.png" alt="image-20230517143143402"></p>
<p><img src="https://tur-mg-img.oss-cn-guangzhou.aliyuncs.com/md-img/202305171432223.png" alt="image-20230517143242120"></p>
<h2 id="七、索引设计原则"><a href="#七、索引设计原则" class="headerlink" title="七、索引设计原则"></a>七、索引设计原则</h2><ul>
<li>针对于数据量较大，且查询比较频繁的表建立索引。</li>
<li>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引。</li>
<li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高</li>
<li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li>
<li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省储空间，避免回表，提高查询效率。</li>
<li>要控制索引的数量，索引并不是多多，索引越多，维护索引结构的代价也就越大，会影响增删改的效率</li>
<li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含 NULL值时，它可以更好地确定哪个索引最有效地用于查询</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/tur-study/about" rel="external nofollow noreferrer">Tur</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://github.com/MathisonTur/tur-study/2023/01/02/MySQL/MySQL--%E7%B4%A2%E5%BC%95/">https://github.com/MathisonTur/tur-study/2023/01/02/MySQL/MySQL--%E7%B4%A2%E5%BC%95/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/tur-study/about" target="_blank">Tur</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tur-study/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/tur-study/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/tur-study/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/tur-study/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/tur-study/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/tur-study/2023/01/02/Java%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91--%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E7%AE%A1%E7%90%86/">
                    <div class="card-image">
                        
                        
                        <img src="/tur-study/medias/featureimages/23.jpg" class="responsive-img" alt="Java并发--共享模型之管理">
                        
                        <span class="card-title">Java并发--共享模型之管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-01-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/tur-study/categories/Java%E5%B9%B6%E5%8F%91/" class="post-category">
                                    Java并发
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tur-study/tags/Java-%E5%B9%B6%E5%8F%91/">
                        <span class="chip bg-color">Java 并发</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/tur-study/2023/01/01/Java%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91--synchronized-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">
                    <div class="card-image">
                        
                        
                        <img src="/tur-study/medias/featureimages/4.jpg" class="responsive-img" alt="Java并发--synchronized的实现原理">
                        
                        <span class="card-title">Java并发--synchronized的实现原理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-01-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/tur-study/categories/Java%E5%B9%B6%E5%8F%91/" class="post-category">
                                    Java并发
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tur-study/tags/Java%E5%B9%B6%E5%8F%91/">
                        <span class="chip bg-color">Java并发</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/tur-study/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/tur-study/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/tur-study/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/tur-study/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/tur-study/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/tur-study/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <a href="/tur-study/about" target="_blank">Tur</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">156.1k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://gitee.com/mathison-tur" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1851727656@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1851727656" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1851727656" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/tur-study/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/tur-study/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/tur-study/libs/materialize/materialize.min.js"></script>
    <script src="/tur-study/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/tur-study/libs/aos/aos.js"></script>
    <script src="/tur-study/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/tur-study/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/tur-study/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/tur-study/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/tur-study/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/tur-study/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/tur-study/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/tur-study/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
